  {% extends "base.html" %}

  {% load static %}

  {% block content %}

  <head>
    <meta charset="UTF-8" />
    <title>Mush! - My Account</title>
    <!--Bootstrap CSS-->
    <link rel="stylesheet" href="{% static 'css/bootstrap.css' %}">
    <!--Font Awesome -->
    <script src="https://kit.fontawesome.com/de938dcd38.js" crossorigin="anonymous"></script>
    <!--JS-->
    <script src="{% static 'js/jquery.js' %}"></script>
    <script src="{% static 'js/owl.carousel.min.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="{% static 'js/bootstrap.js' %}"></script>
    <script src="{% static 'js/apis_handler.js' %}"></script>
    <!--Styling-->
    <style>
      body {
        background: whitesmoke;
        font-family: "Open Sans", sans-serif;
        box-sizing: border-box;
      }

      .btn-primary {
        background-color: rgba(32, 73, 113, 1);
        outline: none;
        border: 0px;
        box-shadow: none;
        width: 100%;
        max-width: 1000px;
        align-items: center;
      }

      .btn-primary:hover,
      .btn-primary:focus,
      .btn-primary:active {
        background-color: #495056;
        outline: none !important;
        border: none !important;
        box-shadow: none;
      }

      .px-2 {
        padding-right: 50px !important;
        padding-left: 50px !important;
      }

      .px {
        padding-top: 100px !important;
      }

      .footer {
        display: none;
      }
    </style>

  <body>
    <!-- Password Reset Form  START-->
    <form method="post" onsubmit="return change_current_password();" id="user-changecurrentpassword-form">
      {% csrf_token %}
      <div class="mb-3 px-2 px">
        <label for="currentPassword" class="form-label">Current password</label>
        <input type="password" required name="current_password" class="form-control" id="currentpassword">
      </div>
      <div class="mb-3 px-2">
        <label for="newPassword" class="form-label">New password</label>
        <input type="password" required name="new_password" class="form-control" id="newpassword">
      </div>
      <div class="mb-3 form-check px-2">
        <label for="confirmPassword" class="form-label">Confirm password</label>
        <input type="password" required name="confirm_password" class="form-control" id="confirmpassword">
      </div>
      <div class="d-grid gap-2 col-6 mx-auto">
        <button class="btn btn-primary" type="submit">Set new password</button>
      </div>
    </form>
    <!-- Password Reset Form  END-->

    <script>
      // form submit event
      const form = document.getElementById("user-changecurrentpassword-form");
      const result = document.getElementById("result");

      form.addEventListener("submit", function (e) {
        const formData = new FormData(form);
        e.preventDefault();
        var object = {};
        formData.forEach((value, key) => {
          object[key] = value;
        });
        var json = JSON.stringify(object);
        result.innerHTML = "Please wait...";

        fetch("https://api.web3forms.com/submit", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Accept: "application/json"
            },
            body: json
          })
          .then(async (response) => {
            let json = await response.json();
            if (response.status == 200) {
              result.innerHTML = json.message;
              result.classList.remove("text-gray-500");
              result.classList.add("text-green-500");
            } else {
              console.log(response);
              result.innerHTML = json.message;
              result.classList.remove("text-gray-500");
              result.classList.add("text-red-500");
            }
          })
          .catch((error) => {
            console.log(error);
            result.innerHTML = "Something went wrong!";
          })
          .then(function () {
            form.reset();
            setTimeout(() => {
              result.style.display = "none";
            }, 5000);
          });
      });
    </script>
  </body>

  {% endblock %}